<html>
	<head>
		<title>Select a Google Sheet - FramerSync</title>
		<script>
			let picker;

			// Use the API Loader script to load google.picker
			function onApiLoad() {
				gapi.load('picker', createPicker);
			}

			// Create and render a Google Picker object for selecting from Drive.
			function createPicker() {
				picker = new google.picker.PickerBuilder()
					.addView(google.picker.ViewId.SPREADSHEETS)
					.setOAuthToken('{{ACCESS_TOKEN}}')
					.setDeveloperKey('{{DEVELOPER_API_KEY}}')
					.setCallback(pickerCallback)
					.build();

				// Open the picker immediately
				picker.setVisible(true);
			}

			function pickerCallback(data) {
				let url = 'nothing';
				if (data[google.picker.Response.ACTION] == google.picker.Action.PICKED) {
					let doc = data[google.picker.Response.DOCUMENTS][0];
					url = doc[google.picker.Document.URL];
				}
				let message = `You picked: ${url}`;
				console.log(message);

				// Send the results to the callback URL
				fetch('{{CALLBACK_URL}}', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ url: url }),
				});
			}
		</script>
		<script async defer src="https://apis.google.com/js/api.js" onload="onApiLoad()"></script>
	</head>
	<body>
		<div id="picker"></div>
	</body>
</html>
